# Test Design: Story 3.2

Date: 2025-09-25 [Fonte: user_info Current Date]
Designer: Quinn (Test Architect) [Fonte: `.bmad-core/agents/qa.md` L34–L37]

## Test Strategy Overview

- Total test scenarios: non disponibile nella fonte
- Unit tests: non disponibile nella fonte
- Integration tests: non disponibile nella fonte
- E2E tests: non disponibile nella fonte
- Priority distribution: non disponibile nella fonte

## Test Scenarios by Acceptance Criteria

### AC1: Prompt ingegnerizzato per rispondere solo dal contesto e citare fonti. [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L15]

| ID            | Level       | Priority | Test                                                  | Justification |
| ------------- | ----------- | -------- | ----------------------------------------------------- | ------------- |
| 3.2-UNIT-001  | Unit        | P1       | Generazione `ChatPromptTemplate` con variabili `question` e `context` | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L42–L53]
| 3.2-UNIT-002  | Unit        | P1       | Il prompt impone uso esclusivo del CONTEXT e citazioni | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L49–L51]

### AC2: L'endpoint riceve domanda e chunk. [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L16]

| ID            | Level       | Priority | Test                                                  | Justification |
| ------------- | ----------- | -------- | ----------------------------------------------------- | ------------- |
| 3.2-INT-001   | Integration | P1       | Richiesta con body contenente `question` e `chunks` accettata | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L124–L131]

### AC3: Invoca l'LLM. [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L17]

| ID            | Level       | Priority | Test                                                  | Justification |
| ------------- | ----------- | -------- | ----------------------------------------------------- | ------------- |
| 3.2-UNIT-003  | Unit        | P1       | Istanziazione `ChatOpenAI(model="gpt-4o-mini", temperature=0)` | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L56–L63]
| 3.2-UNIT-004  | Unit        | P1       | Composizione LCEL `prompt | llm | parser`             | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L91–L99, L103–L104]

### AC4: Restituisce la risposta con citazioni. [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L18]

| ID            | Level       | Priority | Test                                                  | Justification |
| ------------- | ----------- | -------- | ----------------------------------------------------- | ------------- |
| 3.2-UNIT-005  | Unit        | P1       | `AnswerWithCitations` con campi `risposta`, `citazioni` | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L74–L87]
| 3.2-INT-002   | Integration | P1       | Risposta dell'endpoint include `citazioni` riferite agli ID dei chunk | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L113–L116, L132–L136]

### AC5: Gestisce la memoria a breve termine. [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L19]

| ID            | Level       | Priority | Test                                                  | Justification |
| ------------- | ----------- | -------- | ----------------------------------------------------- | ------------- |
| 3.2-INT-003   | Integration | P1       | Persistenza minima di `ChatMessage` con `session_id`, `role`, `content`, `source_chunk_ids` | [Fonte: `docs/stories/3.2.augmented-generation-endpoint.md` L29–L33, L128]

## Risk Coverage

- Collegare quando disponibile al risk profile story 3.2 [Fonte: `docs/qa/assessments/3.2-risk-20250925.md`]

## Recommended Execution Order

1. P1 Unit tests: 3.2-UNIT-001, 3.2-UNIT-002, 3.2-UNIT-003, 3.2-UNIT-004, 3.2-UNIT-005
2. P1 Integration tests: 3.2-INT-001, 3.2-INT-002, 3.2-INT-003

## Gate YAML Block

```yaml
test_design:
  scenarios_total: non disponibile nella fonte
  by_level:
    unit: non disponibile nella fonte
    integration: non disponibile nella fonte
    e2e: non disponibile nella fonte
  by_priority:
    p0: non disponibile nella fonte
    p1: non disponibile nella fonte
    p2: non disponibile nella fonte
  coverage_gaps: []
```

## Trace References

Test design matrix: qa.qaLocation/assessments/3.2-test-design-20250925.md
P0 tests identified: non disponibile nella fonte

## Sources

- `docs/stories/3.2.augmented-generation-endpoint.md` (AC, orchestrazione LLM)
- `.bmad-core/tasks/test-design.md` (schema output)
- `.bmad-core/agents/qa.md` (identità QA)
