# NFR Assessment — Story 2.6.1: Production Infrastructure Critical Fixes

**Date:** 2025-10-11  
**Epic:** 2 — Core RAG Knowledge Pipeline  
**Story:** 2.6.1 — Production Infrastructure Critical Fixes (P1)  
**Scope:** Docker Compose, Traefik routing, Redis durability, DB connectivity

## Context
- Story 2.6 reported three P1 gaps blocking production: DB connectivity, Redis data loss on restart, and `/health` routing to web instead of API.
- Story 2.6.1 delivered targeted infra fixes and validation artifacts (scripts + docs) to unblock production readiness while leaving P2 hardening for later.

## Evidence Collected
- Health check: `docs/reports/rag-infrastructure-health.md` — Overall PASS
- DB audit: `docs/reports/rag-database-integrity.md` — Overall OK (0 orphan, 0 NULL, pgvector idx present)
- Readiness summary: `docs/reports/rag-production-readiness-summary.md` — READY (P1 risolti)
- Troubleshooting docs: Redis, Traefik, DB connectivity

## NFR Dimensions
- Reliability & Availability — PASS
  - Dedicated `/health` router (Traefik) returns JSON reliably; infra checker PASS after restart.
  - Celery worker reachable; logs indicate “ready”.
- Data Durability — PASS
  - Redis persistence via AOF + named volume verified; keys survive container and full stack restarts.
- Observability — PASS
  - Health endpoint routable and visible; infra report generated; DB audit scripts produce JSON and Markdown outputs.
- Performance — NEUTRAL/UNCHANGED
  - No regression expected; DB Pooler compatibility handled by disabling prepared statements in scripts.
  - AC4 benchmarks remain planned as P2.
- Security — CONCERNS (P2)
  - CORS production policy still permissive; recommendation to restrict.
  - Containers run without explicit restart/healthcheck policy and celery logs warn about root; recommend user/non-root + policies.
- Operability — PASS (with P2 actions)
  - Admin guide updated with DB connectivity debug appendix; troubleshooting docs available.

## Risks and Mitigations
- Missing restart policies/healthchecks (P2): configure `restart: unless-stopped` and Docker `healthcheck` for API/Celery.
- CORS policy permissive: restrict to production domains.
- Celery runs as root (warning): follow best practice to run as non-root in production images.

## Decision
- Gate: PASS (with P2 follow-ups)
- Rationale: All P1 production blockers fixed and validated; residuals are standard hardening tasks that do not block RAG functionality or deployment.

## Follow-ups (P2)
1. Add restart policies (api, celery-worker, redis) and container healthchecks.
2. Restrict CORS in production configuration.
3. Schedule AC4 performance benchmarks with a representative dataset and OpenAI budget.
