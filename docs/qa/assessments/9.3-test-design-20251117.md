# Test Design: Story 9.3

Date: 2025-11-17
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 20
- Unit tests: 5 (25%)
- Integration tests: 6 (30%)
- E2E tests: 9 (45%)
- Priority distribution: P0: 4, P1: 9, P2: 7

## Test Scenarios by Acceptance Criteria

### AC1: Sidebar Toggle - Icona sandwich apre/chiude sidebar

#### Scenarios

| ID            | Level | Priority | Test                                                      | Justification                 |
| ------------- | ----- | -------- | --------------------------------------------------------- | ----------------------------- |
| 9.3-UNIT-001  | unit  | P2       | Toggle reducer/state transitions open↔close               | Chosen by framework: Pure logic |
| 9.3-E2E-001   | e2e   | P2       | Hamburger toggles sidebar on mobile and stays on desktop | Chosen by framework: Critical user journey |

### AC2: Session List Display - Lista completa sessioni con scroll e ordering

#### Scenarios

| ID            | Level | Priority | Test                                                            | Justification                 |
| ------------- | ----- | -------- | --------------------------------------------------------------- | ----------------------------- |
| 9.3-UNIT-002  | unit  | P2       | Format ID (first 8 chars) and timestamp rendering              | Chosen by framework: Pure logic |
| 9.3-INT-001   | integration | P1  | Persist/hydrate sessions in localStorage; ordering by recency  | Chosen by framework: Cross-component behavior |
| 9.3-E2E-002   | e2e   | P2       | List renders, scrolls when >10, ordered newest first           | Chosen by framework: Critical user journey |

### AC3: Load Conversation - Click item carica history e focus input

#### Scenarios

| ID            | Level | Priority | Test                                                                      | Justification                 |
| ------------- | ----- | -------- | ------------------------------------------------------------------------- | ----------------------------- |
| 9.3-INT-002   | integration | P1  | API call to history endpoint returns and merges correctly into UI state   | Chosen by framework: Cross-component behavior |
| 9.3-E2E-003   | e2e   | P1       | Click session loads messages, closes sidebar on mobile, focuses input     | Chosen by framework: Critical user journey |

### AC4: New Chat Button - Crea nuova sessione, pulisce messaggi, focus input

#### Scenarios

| ID            | Level | Priority | Test                                                             | Justification                 |
| ------------- | ----- | -------- | ---------------------------------------------------------------- | ----------------------------- |
| 9.3-UNIT-003  | unit  | P2       | UUID v4 generation and store add/remove consistency              | Chosen by framework: Pure logic |
| 9.3-INT-003   | integration | P1  | New chat clears current messages and focuses input via ref       | Chosen by framework: Cross-component behavior |
| 9.3-E2E-004   | e2e   | P1       | Click "Nuova Chat" creates session, clears messages, focuses input | Chosen by framework: Critical user journey |

### AC5: Session Menu Actions - Menu ⋮ con Rinomina/Elimina non attiva click riga

#### Scenarios

| ID            | Level | Priority | Test                                                              | Justification                 |
| ------------- | ----- | -------- | ----------------------------------------------------------------- | ----------------------------- |
| 9.3-UNIT-004  | unit  | P2       | Dropdown open/close state does not trigger row click (stopPropagation) | Chosen by framework: Pure logic |
| 9.3-E2E-005   | e2e   | P2       | Three-dots opens menu; selecting option doesn’t load conversation | Chosen by framework: Critical user journey |

### AC6: Rename Dialog - PATCH metadata e update UI

#### Scenarios

| ID            | Level | Priority | Test                                                                    | Justification                 |
| ------------- | ----- | -------- | ----------------------------------------------------------------------- | ----------------------------- |
| 9.3-INT-004   | integration | P1  | PATCH updates display_name server-side; store/UI reflect new name       | Chosen by framework: Cross-component behavior |
| 9.3-E2E-006   | e2e   | P1       | Rename modal validates input and shows success/error toast              | Chosen by framework: Critical user journey |

### AC7: Delete Confirmation - Dialog conferma cancellazione

#### Scenarios

| ID            | Level | Priority | Test                                                                  | Justification                 |
| ------------- | ----- | -------- | --------------------------------------------------------------------- | ----------------------------- |
| 9.3-UNIT-005  | unit  | P0       | AlertDialog action handler prevents default and awaits async          | Chosen by framework: Pure logic |
| 9.3-E2E-007   | e2e   | P0       | Delete modal flow: cancel does nothing; confirm proceeds to API call | Chosen by framework: Critical user journey |

### AC8: Backend Hard Delete - DELETE endpoint behavior incl. errors

#### Scenarios

| ID            | Level | Priority | Test                                                                 | Justification                 |
| ------------- | ----- | -------- | -------------------------------------------------------------------- | ----------------------------- |
| 9.3-INT-005   | integration | P0  | DELETE success (204), 404 idempotent, 401 unauthorized, 429 rate-limit handling | Chosen by framework: Cross-component behavior |

### AC9: Delete UI Behavior - Rimuove item, new chat auto, toast

#### Scenarios

| ID            | Level | Priority | Test                                                                 | Justification                 |
| ------------- | ----- | -------- | -------------------------------------------------------------------- | ----------------------------- |
| 9.3-INT-006   | integration | P1  | After delete, state reconciles; if current session deleted, new chat started | Chosen by framework: Cross-component behavior |
| 9.3-E2E-008   | e2e   | P1       | After delete success: list updates, auto new chat if needed, toast   | Chosen by framework: Critical user journey |

### AC10: Responsive Design - Mobile overlay vs desktop persistent

#### Scenarios

| ID            | Level | Priority | Test                                                          | Justification                 |
| ------------- | ----- | -------- | ------------------------------------------------------------- | ----------------------------- |
| 9.3-E2E-009   | e2e   | P2       | Sidebar behaves per breakpoint; transitions smooth (300ms)    | Chosen by framework: Critical user journey |

## Risk Coverage

- P0 scenarios cover destructive delete and auth/error-sensitive flows (mitigate SEC-001, DATA-001).
- Integration tests cover API error handling (404/401/429) and state reconciliation.
- E2E tests validate UX-critical sidebar operations across breakpoints.

## Recommended Execution Order

1. P0 Unit tests (fail fast)
2. P0 Integration tests
3. P0 E2E tests
4. P1 tests in order
5. P2 tests as time permits

