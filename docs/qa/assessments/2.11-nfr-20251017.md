# NFR Assessment — Story 2.11 (Chat RAG E2E)

Date: 2025-10-17
Story: docs/stories/2.11.chat-rag-activation.md
Scope: security, performance, reliability, maintainability

## Context & Inputs
- Source story status: Ready for Review
- Related hardening work: docs/stories/2.7.database-hardening-and-performance.md (in progress)
- QA config: .bmad-core/core-config.yaml (qa.qaLocation: docs/qa)
- Evidence: test suites green (backend + frontend), chat 400 bug fixed, citations include chunk_id/document_id, retriever threshold tuned

## Targets (found/missing)
- Security: Auth via Supabase JWT; rate limiting 60 rpm on chat endpoint (found). MFA/leaked-password protections pending from 2.7 (partially missing).
- Performance: No explicit response-time target in 2.11; 2.7 references p95 validation = ~1000ms baseline; FE/BE tests green but no explicit SLO (missing explicit SLO here).
- Reliability: Error handling present, normalization of IDs, backend/FE tests pass; no explicit circuit breaker semantics; health checks not referenced in 2.11 (partial).
- Maintainability: Tests exist (pytest, FE unit); coverage target not stated; chunking strategy to be finalized (2.11 AC3) and documented (partial).

## Assessment by NFR
- Security — CONCERNS
  - Positives: AuthN/AuthZ patterns present; chat endpoint rate-limited (60 rpm); Pydantic validation fixed; RLS hardening ongoing in 2.7; functions hardened and ownership patterns planned.
  - Gaps: MFA and leaked-password protection not fully enforced; vector extension schema migration pending; confirm secrets management (.env) and CI/CD secret scanning.
- Performance — CONCERNS
  - Positives: Suites green; p95 regression checks exist in 2.7; retriever threshold tuned; embedding/retrieval paths functioning.
  - Gaps: No explicit SLO for chat latency in 2.11; no load test for end-to-end chat throughput; chunking optimization may affect latency/cost.
- Reliability — PASS (advisory)
  - Positives: 400 error resolved; robust validation; propagation of identifiers; FE+BE tests; fallback behavior when LLM unavailable noted.
  - Notes: Consider documenting retry policy and circuit breakers (LLM backend + DB) and add basic health checks if missing.
- Maintainability — CONCERNS
  - Positives: Tests exist; story-driven documentation; clear file locations; AC3 mandates documented strategy.
  - Gaps: Coverage target unstated; chunking strategy still to finalize/apply; ensure linters/formatters and architectural docs updated concurrently.

## Deterministic Result
- Statuses: Security=CONCERNS, Performance=CONCERNS, Reliability=PASS, Maintainability=CONCERNS
- Quality score: 100 - (10*3 CONCERNS) = 70

## Gate YAML (paste-ready)
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: CONCERNS
    notes: "Auth+rate limiting present; MFA/leaked-password hardening pending; verify secrets scanning"
  performance:
    status: CONCERNS
    notes: "No explicit chat SLO; add p95/p99 targets; run E2E load test"
  reliability:
    status: PASS
    notes: "400 fix, tests pass, IDs normalized; add retry/circuit-breaker docs"
  maintainability:
    status: CONCERNS
    notes: "Finalize chunking strategy + docs; set coverage target; ensure tooling"

## Recommendations
- Security: Close 2.7 hardening items (MFA, leaked-password protection), confirm secret scanning in CI, migrate ector to dedicated schema as planned.
- Performance: Define SLO for chat (e.g., p95 = 1000ms, p99 = 2000ms), run scripted load (scripts/perf) against chat E2E, watch DB indices and cache strategy.
- Reliability: Add/verify health endpoints and basic retry/backoff around LLM calls; document failure modes and fallbacks.
- Maintainability: Decide and apply final chunking strategy (AC3), add coverage target (e.g., 80%), keep architecture docs in sync.

## Evidence Pointers
- Story: docs/stories/2.11.chat-rag-activation.md
- Hardening: docs/stories/2.7.database-hardening-and-performance.md
- Perf tooling: scripts/perf/.env.staging.local, scripts/perf/run_p95.ps1
- Validation scripts: scripts/validation/run_chunk_integrity_check.ps1

--
Generated by QA NFR quick assessment.
