# Test Design: Story 6.7 — Chat UI/UX Enhancements

Date: 2025-10-21
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 24
- Unit tests: 9 (38%)
- Integration tests: 9 (38%)
- E2E tests: 6 (25%)
- Priority distribution: P0: 8, P1: 11, P2: 5

Rationale: Copertura bilanciata fra accessibilità, navigazione e comportamento responsive. P0 dedicati a flussi tastiera/a11y, sincronizzazione loading in-chat, e regressioni layout critiche (full-height + form centrati).

## Test Scenarios by Acceptance Criteria

### AC1: Header di Navigazione Globale

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-UNIT-001 | Unit        | P1       | Navigation rende 3 link con label accessibili                                       | Base rendering e a11y minimale                 |
| 6.7-UNIT-002 | Unit        | P1       | Stato attivo calcolato con router hook (match esatto route)                          | Evita incoerenze active state                  |
| 6.7-INT-001  | Integration | P0       | Navigazione tra `/chat`, `/admin/dashboard`, `/login` aggiorna attivo e contenuto    | Flusso principale utente                       |
| 6.7-E2E-001  | E2E         | P0       | Keyboard-only: tab order corretto, attivazione link via Enter/Space                  | A11Y critica                                   |
| 6.7-UNIT-003 | Unit        | P2       | Responsiveness <768px: menu hamburger/stack visivo (snapshot classi)                 | Verifica comportamento mobile                  |

### AC2: Indicatore di Caricamento In-Chat

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-UNIT-004 | Unit        | P0       | LoadingIndicator espone `role="status"` (o `progressbar`) e `aria-live="polite"`       | Requisito a11y critico                         |
| 6.7-INT-002  | Integration | P0       | Indicator appare dentro ChatMessagesList durante richiesta e scompare a risposta     | Sincronizzazione stato async                   |
| 6.7-INT-003  | Integration | P1       | Rimozione del vecchio `<div>Caricamento...</div>` (assenza nel DOM)                   | Evita doppio/errato contesto                   |
| 6.7-E2E-002  | E2E         | P1       | Screen reader annuncia stato di caricamento                                          | Usabilità utenti SR                            |

### AC3: Chat Card a Piena Altezza

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-INT-004  | Integration | P0       | Layout `flex flex-col` con area chat `flex-1 overflow-y-auto` tra header e input     | Struttura critica del layout                   |
| 6.7-INT-005  | Integration | P0       | Auto-scroll al fondo su nuovi messaggi (ref + `scrollIntoView`)                      | UX essenziale chat                             |
| 6.7-E2E-003  | E2E         | P1       | Mobile: altezza corretta con tastiera virtuale (iOS/Android)                          | Rischio mobile alto                            |
| 6.7-UNIT-005 | Unit        | P2       | Rimozione `min-h-[300px]` dalla card (snapshot/stili)                                 | Prevenzione regressioni                         |

### AC4: Input Textarea Adattivo

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-UNIT-006 | Unit        | P0       | Auto-resize: altezza cresce fino a 4 righe e poi scroll interno                      | Requisito UX core                              |
| 6.7-UNIT-007 | Unit        | P1       | Reset height a `auto` prima di calcolo `scrollHeight` (no loop)                       | Evita loop/bug prestazionali                   |
| 6.7-INT-006  | Integration | P1       | Submit: Enter invia, Shift+Enter va a capo                                          | Requisito interazione                          |
| 6.7-E2E-004  | E2E         | P1       | Inserimento testo multi-riga, espansione visiva, invio messaggio                     | Validazione end-to-end                          |
| 6.7-UNIT-008 | Unit        | P2       | Placeholder visibile e button allineato verticalmente al bottom                      | Coerenza UI                                    |

### AC5: Form Login/AccessCode Centrati Verticalmente

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-INT-007  | Integration | P0       | `LoginPage` e `AccessCodePage`: `min-h-screen` + `items-center justify-center`       | Layout critico                                 |
| 6.7-E2E-005  | E2E         | P1       | Nessun layout shift visibile durante error/loading                                   | Stabilità visiva                               |
| 6.7-UNIT-009 | Unit        | P2       | Il contenitore interno mantiene `max-w-md`                                           | Requisito UI                                   |

### AC6: Dashboard Centrata Verticalmente

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-INT-008  | Integration | P1       | Applicazione opzione A (centramento) o B (`pt-16/20`) coerente con header             | Coerenza cross-pagina                          |
| 6.7-E2E-006  | E2E         | P2       | Leggibilità non degradata con molto contenuto                                        | Verifica reale d’uso                            |

### AC7: Componenti Shadcn/UI Utilizzati

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-INT-009  | Integration | P1       | `Textarea` shadcn presente/usato o fallback custom coerente                          | Allineamento design system                      |
| 6.7-INT-010  | Integration | P2       | `Separator` opzionale nel header non rompe layout                                    | Regressioni minori                             |

## Cross-Cutting A11Y and Regression Scenarios

| ID           | Level       | Priority | Test                                                                                 | Justification                                  |
|--------------|-------------|----------|--------------------------------------------------------------------------------------|-----------------------------------------------|
| 6.7-E2E-007  | E2E         | P0       | Keyboard-only full journey: login → dashboard → chat                                 | A11Y critica                                   |
| 6.7-INT-011  | Integration | P0       | Axe checks: zero violations su pagine toccate                                        | Gate di qualità a11y                           |
| 6.7-INT-012  | Integration | P1       | Visual regression su viewport chiave (desktop/tablet/mobile)                          | Evita regressioni CSS                          |
| 6.7-INT-013  | Integration | P1       | CLS: loading indicator riserva spazio; no layout shift                                | Copre rischio PERF-UI-002                      |

## Risk Coverage Mapping

- UX-ACC-001 (Critical): 6.7-E2E-007, 6.7-INT-011, 6.7-UNIT-004, 6.7-INT-002
- NAV-001 (High): 6.7-UNIT-002, 6.7-INT-001
- PERF-UI-001 (High): 6.7-E2E-003, 6.7-INT-004
- REG-001 (High): 6.7-INT-012, 6.7-INT-013
- UX-002 (Medium): 6.7-UNIT-006, 6.7-UNIT-007
- UX-003 (Medium): 6.7-INT-006
- A11Y-002 (Medium): 6.7-INT-011
- MOB-001 (Medium): 6.7-E2E-003
- INT-001 (Low): 6.7-INT-002, 6.7-INT-003
- TEST-001 (Low): Coperto da introduce di test a11y e E2E

## Recommended Execution Order

1. P0 A11Y/Keyboard: 6.7-E2E-007, 6.7-UNIT-004, 6.7-INT-011
2. P0 Layout core: 6.7-INT-004, 6.7-INT-005
3. P0 Navigation flow: 6.7-INT-001
4. P0 Loading sync: 6.7-INT-002
5. P1 Interaction/responsive: 6.7-INT-006, 6.7-E2E-003, 6.7-UNIT-006, 6.7-UNIT-002, 6.7-INT-012, 6.7-INT-013
6. P2 Stabilization: 6.7-UNIT-003, 6.7-UNIT-005, 6.7-UNIT-008, 6.7-UNIT-009, 6.7-E2E-006

## Environment, Data, and Execution Notes

- Web tests: Vitest + React Testing Library per unit/integration; Playwright per E2E.
- A11Y: usare `@axe-core/playwright` o `jest-axe` per checks automatici; target zero violazioni critiche.
- Viewports: desktop 1920x1080, laptop 1366x768, tablet 768x1024, mobile 375x667 e 414x896.
- Mobile keyboard: validare manualmente su iOS Safari e Chrome Android; documentare esiti in report.
- Visual regression: se disponibile, integrare Percy/Chromatic; altrimenti snapshot RTL e screenshot Playwright.
- Feature flags: non richiesti; assicurarsi che le route siano accessibili in ambiente di test.

## Gate YAML Block

test_design:
  scenarios_total: 24
  by_level:
    unit: 9
    integration: 9
    e2e: 6
  by_priority:
    p0: 8
    p1: 11
    p2: 5
  coverage_gaps: []

## Trace References

Story: docs/stories/6.7.chat-ui-ux-enhancements.md
Risk profile: docs/qa/assessments/6.7-risk-20251021.md

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels appropriate and non-duplicative
- [x] Priorities align with risk profile
- [x] Test IDs follow convention
- [x] A11Y and mobile scenarios included

