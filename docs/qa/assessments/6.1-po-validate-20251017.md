# PO Validation — Story 6.1: Pipeline Documentation & Watcher Enhancement

Date: 2025-10-17
Owner: Product Owner (Sarah)
Story: docs/stories/6.1.pipeline-documentation-watcher-enhancement.md
Status of Story: Draft

## Summary Decision
Decision: CONCERNS — requires updates before moving out of Draft.

Rationale: Story intent and scope are clear and well-motivated. Acceptance Criteria (AC1–AC6) are comprehensive and testable, but the story is still marked Draft and includes a few items needing sharpening to ensure unambiguous developer handoff and efficient validation.

## Validation Checklist
- Clarity of Problem/Outcome: Clear
- Scope Boundaries: Clear (dual pipelines alignment + watcher enhancement + docs)
- Acceptance Criteria: Comprehensive, traceable to tasks/tests
- Testability: High (explicit unit/integration targets, coverage)
- Dependencies Identified: Yes (DocumentExtractor, classifier, router, settings)
- Non-Functional Expectations: Partially specified (performance targets defined in QA artifacts; reflect in AC?)
- Rollback/Feature Flag: Present (good)
- Documentation Updates: Explicit (AC1, AC6)
- Ambiguities/Assumptions: Minor items listed below

## Findings and Required Updates
1) Story Status
- Current: Draft
- Required: Move to “Ready for Dev” only after required updates below are applied.

2) Acceptance Criteria precision
- AC3: Add explicit default values to the ACs (already described in config example but mirror in AC):
  - `WATCHER_ENABLE_CLASSIFICATION=true` (default)
  - `CLASSIFICATION_TIMEOUT_SECONDS=10` (default) and valid range (e.g., 1–60)
- AC4: Record exact strategy names expected (e.g., `recursive_character_800_160`, `tabular_structural`) to align with logs/tests.
- AC4: Make confidence threshold explicit (e.g., min 0.7) for using classification-driven routing.
- AC5: Specify exact test file path pattern and module target (already suggested) to reduce ambiguity: `apps/api/tests/test_watcher_enhanced.py`, `--cov=api.ingestion.watcher`.

3) Documentation cross-linking
- AC1/AC6: List the exact documents to add cross-links in (e.g., `docs/architecture/index.md`, `docs/architecture/sezione-6-componenti.md`, any ingestion overview doc), and the link titles.

4) Observability requirements
- Promote the metrics outlined in QA risk profile into AC4/AC5 as acceptance checks, not only dev notes:
  - classification_success_total, classification_failure_total, classification_latency_ms
  - strategy_distribution{recursive,tabular,fallback}
  - fallback_total with ratio computation visible in logs/metrics

5) Cost governance
- Add a simple acceptance note to ensure cost controls are present (e.g., classification only on new/changed documents and/or per-hour cap configurable). This can be AC3 or AC4.

6) Backward compatibility
- AC6 lists removal of the “per ora non presente” comment; add a note to retain legacy fallback code path and confirm feature-flag OFF path matches pre-story behavior via a test in AC5.

## Dependencies & Sequencing
- No external blockers identified; relies on existing components (`DocumentExtractor`, `classify_content_enhanced`, `ChunkRouter`).
- Sequencing proposal:
  1) Update config + watcher to integrate extractor and flag.
  2) Implement classification invocation + timeouts + logging.
  3) Route strategies and record `chunking_strategy`.
  4) Add metrics & logs.
  5) Update docs (comparison + addendum + links).
  6) Add/extend tests and confirm coverage.

## Acceptance Testability
- Each AC maps to concrete verifications (see QA test design document):
  - AC1/AC6: existence + content checks for docs; link checks.
  - AC2/AC3/AC4: unit/integration with mocks; explicit strategy assertions.
  - AC5: coverage gate > 85% for watcher.

## Recommendation to Move Forward
- Apply the “Required Updates” to the ACs and doc list, then set Status to “Ready for Dev”.
- Keep the QA gate conditions (performance/observability) as release-blockers for merge.

## References
- QA Risk Profile: docs/qa/assessments/6.1-risk-profile-20251017.md
- QA Test Design: docs/qa/assessments/6.1-test-design-20251017.md

