# PO Validation — Story 6.2: Watcher Configuration Diagnostics & Stabilization

Date: 2025-10-19
Reviewer: Sarah (Product Owner)
Story: docs/stories/6.2.watcher-configuration-diagnostics-and-stabilization.md

## Template Compliance Issues
- Sections present and well-structured: Story, Context, Acceptance Criteria, Dev Notes, Files, Dependencies, References, Security, Performance, Testing, DoD, Change Log, QA Results, Dev Agent Record.
- Placeholders: None left, but multiple encoding artifacts present (e.g., "�%�", "�?o", "��'"). These must be corrected to avoid ambiguity in AC text and logs.
- Agent sections (QA Results, Dev Agent Record) exist for downstream updates.

## Critical Issues (Must Fix - Story Blocked)
- None blocking. Requirements are actionable and testable. However, path specificity requires alignment (see Should-Fix).

## Should-Fix Issues (Important Quality Improvements)
- Path accuracy and consistency:
  - Story references `api/config.py`, `api/ingestion/config.py`, `api/ingestion/watcher.py` but project structure indicates `apps/api/api/...`. Recommend standardizing paths to `apps/api/api/...` or clarifying repo root for paths.
  - Poetry commands reference `--directory apps/api` which aligns with structure — ensure all file paths match this convention.
- Encoding artifacts in ACs and Dev Notes:
  - Replace garbled symbols: "�%�" should be ">=", "<=", or "!=" per intent; "�?o" likely "Troubleshooting Watcher"; "��'" likely "→" or "->". Ensure consistent use of ASCII or valid UTF-8 punctuation.
- AC6 exit code wording:
  - Text says: "Exit code �%� 0 su errori bloccanti". This likely means "non-zero on blocking errors". Clarify explicitly: "Exit code != 0 on blocking errors; 0 on success".
- Reference correctness:
  - "docs/architecture/sezione-3-tech-stack.md" may not exist; repository lists `docs/architecture/tech-stack.md`. Update references to existing documents.
- Logging field names:
  - Ensure the event `classifier_llm_initialized` schema is defined with exact keys and types to support assertions (model, base_url, project, source). Add to Dev Notes for precision.

## Nice-to-Have Improvements (Optional Enhancements)
- Provide explicit examples for `print_settings` redacted JSON output (one snippet) to standardize expectations across environments.
- Add explicit recommended defaults in `.env.example` for the new Settings fields (`ingestion_watch_dir`, `ingestion_temp_dir`, `CLASSIFICATION_TIMEOUT_SECONDS`, `CLASSIFICATION_CACHE_ENABLED`). AC mentions modification but showing sample values would accelerate setup.
- For scripts in AC1, include a short checklist of preconditions (docker running, compose file names, container names) to reduce false negatives.

## Acceptance Criteria Satisfaction Assessment
- AC1–AC8 are specific, measurable, and testable. Tasks list includes file create/modify map; sequencing guidance provided under "Dipendenze tra AC".
- Testability is high; unit and E2E targets are explicit. Risk-based areas are covered.
- Success definitions clear per AC with observable outputs (logs, files, warnings, exit codes).

## Validation and Testing Instructions Review
- Testing approach outlined in story plus AC8 test list is sufficient. Suggest adding explicit note to run unit tests for validator warnings under both `dev` and `prod` environment settings.
- Tools: Poetry invocation for API module is specified; confirm test runner command (e.g., `pytest`) under `apps/api` to avoid ambiguity.

## Security Considerations Assessment
- Redaction policy for `print_settings` included; recommend listing all sensitive keys explicitly (OPENAI_API_KEY, SUPABASE_SERVICE_KEY, database URLs, etc.) and testing redaction.
- No additional auth/authorization flows in scope; primary risk is secret leakage via diagnostics.

## Tasks/Subtasks Sequence Validation
- Proposed sequence is logical: stabilize Settings and ingestion config → Redis gracefulness → print_settings → diag runner → ops scripts → docs → tests.
- Dependencies clear; no blocking circularities identified.

## Anti-Hallucination Findings
- Architecture references: adjust "sezione-3-tech-stack.md" to actual `docs/architecture/tech-stack.md`.
- All other references appear to exist (ingestion-pipelines-comparison.md, monitoring.md). Verify exact container service names used in docker commands match compose file.
- No invented libraries; Pydantic Settings and Redis usage consistent with repo patterns.

## Final Assessment
- GO: Story is ready for implementation with minor clarifications.
- Implementation Readiness Score: 8/10
- Confidence Level: High

### Required Edits Before Handoff
1) Fix encoding artifacts throughout the story text.
2) Align file paths to `apps/api/api/...` or clarify path root in the story.
3) Clarify AC6 exit code semantics (non-zero on blocking errors).
4) Correct architecture reference filename.

### Advisory Notes
- Coordinate with QA to re-evaluate the gate once AC3/AC5 implementations and tests land, as the QA gate currently sits at CONCERNS due to high-risk areas.

