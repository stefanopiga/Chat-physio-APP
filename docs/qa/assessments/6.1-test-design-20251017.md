# Test Design: Story 6.1

Date: 2025-10-17
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 28
- Unit tests: 11 (39%)
- Integration tests: 13 (46%)
- E2E tests: 4 (15%)
- Priority distribution: P0: 9, P1: 12, P2: 7

## Test Scenarios by Acceptance Criteria

### AC1: Documentazione Pipeline Duale

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-001    | Unit  | P2       | Lint/links checker: reference links exist                  | Pure doc validation |
| 6.1-INT-001     | Integration | P2 | Build docs index includes comparison page                  | Ensures cross-linking integrity |
| 6.1-E2E-001     | E2E   | P2       | Open docs site: compare table visible for both pipelines   | Critical doc visibility |

Mitigates risks: BUS-001

### AC2: Integrazione DocumentExtractor in Watcher

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-002    | Unit  | P1       | DocumentExtractor returns text+metadata for PDF/DOCX/TXT   | Algorithmic behavior |
| 6.1-INT-002     | Integration | P0 | Watcher uses DocumentExtractor instead of basic extract    | Component interaction |
| 6.1-INT-003     | Integration | P1 | Propagates images_count/tables_count to document metadata  | Data flow correctness |
| 6.1-INT-004     | Integration | P1 | Handles extraction exceptions gracefully                   | Robustness |

Mitigates risks: DATA-001, TECH-002

### AC3: Classificazione LLM in Watcher con Feature Flag

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-003    | Unit  | P1       | Settings defaults: flag true, timeout 10                   | Config logic |
| 6.1-INT-005     | Integration | P0 | Flag ON -> classify_content_enhanced called                | Contract with classifier |
| 6.1-INT-006     | Integration | P0 | Flag OFF -> classification skipped                         | Legacy parity |
| 6.1-INT-007     | Integration | P0 | Timeout handling -> fallback with warning log              | Reliability |
| 6.1-INT-008     | Integration | P1 | Classify only new/modified files (inventory/hash respected)| Governance |

Mitigates risks: TECH-001, PERF-001, OPS-001

### AC4: Chunking Intelligente Attivo

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-004    | Unit  | P1       | Router applies strategy by classification & confidence      | Pure routing logic |
| 6.1-INT-009     | Integration | P1 | Mock classification: TESTO_ACCADEMICO_DENSO -> recursive    | Integration path |
| 6.1-INT-010     | Integration | P1 | Mock classification: DOCUMENTO_TABELLARE -> tabular         | Integration path |
| 6.1-INT-011     | Integration | P1 | Confidence <0.7 -> fallback strategy                        | Threshold behavior |
| 6.1-INT-012     | Integration | P1 | Strategy name recorded in document.chunking_strategy        | Data persistence |

Mitigates risks: TECH-003, PERF-003

### AC5: Test Coverage Pipeline Watcher Enhanced

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-005    | Unit  | P1       | Unit tests for extractor utilities                         | Fast feedback |
| 6.1-INT-013     | Integration | P0 | Coverage >85% for watcher module                           | Safety net |
| 6.1-INT-014     | Integration | P0 | Legacy compatibility: behavior with flag=false equals pre-6.1 | Regression control |
| 6.1-INT-015     | Integration | P1 | Metrics logs emitted for classification + routing           | Observability contract |

Mitigates risks: TECH-001, OPS-002

### AC6: Aggiornamento Documentazione Architetturale

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-006    | Unit  | P2       | Benchmark addendum “Note Implementazione” present           | Doc rule |
| 6.1-INT-016     | Integration | P2 | Links from related docs point to comparison doc             | Cross-doc integrity |
| 6.1-UNIT-007    | Unit  | P2       | Watcher comment “per ora non presente” removed              | Static validation |

Mitigates risks: BUS-001

### AC7: Osservabilità e Monitoraggio

#### Scenarios

| ID              | Level | Priority | Test                                                       | Justification |
|-----------------|-------|----------|------------------------------------------------------------|---------------|
| 6.1-UNIT-008    | Unit  | P1       | WatcherMetrics: computes p50/p95/p99 correctly              | Pure calc |
| 6.1-INT-017     | Integration | P0 | Structured logs: classification success/failure with timing | Contract with logging |
| 6.1-INT-018     | Integration | P0 | Metrics exported in Prometheus format                       | Integration to monitoring |
| 6.1-INT-019     | Integration | P1 | Alerts configurable and thresholds honored                  | Config contract |
| 6.1-E2E-002     | E2E   | P1       | Staging validation script meets SLO thresholds              | End-to-end SLO |

Mitigates risks: OPS-002, OPS-003, PERF-001, PERF-003

## Risk Coverage

- TECH-001: 6.1-INT-006, 6.1-INT-014 (plus E2E-003 legacy parity)
- PERF-001: 6.1-INT-007, 6.1-INT-017, 6.1-E2E-002
- OPS-001: 6.1-INT-008
- DATA-001: 6.1-UNIT-002, 6.1-INT-003
- TECH-002: 6.1-INT-004
- OPS-002: 6.1-INT-015, 6.1-INT-017, 6.1-INT-018
- SEC-001: 6.1-UNIT-009 (log redaction), 6.1-INT-020 (no sensitive payloads)
- PERF-002: 6.1-INT-021 (cache degradation)
- TECH-003: 6.1-UNIT-004, 6.1-INT-009..012
- BUS-001: 6.1-UNIT-001, 6.1-INT-001, 6.1-UNIT-007

## Recommended Execution Order

1. P0 Unit tests (6.1-UNIT-003, -005, -008)
2. P0 Integration tests (6.1-INT-002, -005, -006, -007, -013, -014, -017, -018)
3. P0 E2E tests (6.1-E2E-002)
4. Remaining P1 tests (routing, metadata, governance)
5. P2 documentation validations

---

test_design:
  scenarios_total: 28
  by_level:
    unit: 11
    integration: 13
    e2e: 4
  by_priority:
    p0: 9
    p1: 12
    p2: 7
  coverage_gaps: []

```
Test design matrix: qa.qaLocation/assessments/6.1-test-design-20251017.md
P0 tests identified: 9
```

