# 4.2 – Traceability Matrix: Analytics Dashboard

## Meta
- Story: 4.2 (docs/stories/4.2.analytics-dashboard.md)
- Data: 2025-10-04
- Stato Story: Implemented ✅ (riga 3)
- Epic: Epic 4 — Post-MVP Enhancements (riga 8)

## Ambito Tracciato
- Rotta: `/admin/analytics` con sezioni Panoramica, Domande, Feedback, Performance (righe 27-31)
- Backend endpoint: `GET /api/v1/admin/analytics` (riga 46)
- Frontend page: `apps/web/src/pages/AnalyticsPage.tsx` (righe 119-123, 475)
- Dati: `chat_messages_store`, `feedback_store`, `ag_latency_samples_ms` (righe 79-82)

## Matrice di Tracciabilità

### Requisiti → Implementazione → Verifica

1. Panoramica con 4 KPI card (totale query, sessioni, feedback ratio, avg latency)
   - Implementazione: UI KPI cards in `AnalyticsPage.tsx` (righe 124-145)
   - Verifica: Unit test frontend 3, 6 (righe 266-274); E2E scenario 2 (righe 286-287)

2. Domande: tabella top query con count e last_queried_at
   - Implementazione: tabella in `AnalyticsPage.tsx` (righe 147-151) e aggregation top 10 (righe 93-98)
   - Verifica: Unit test frontend 4 (righe 270-271); E2E scenario 3 (righe 287-288)

3. Feedback: ratio up/down + bar chart
   - Implementazione: BarChart in `AnalyticsPage.tsx` (righe 153-158); feedback ratio (righe 99-104)
   - Verifica: Unit test frontend 5 (righe 271-272); E2E scenario 4 (righe 288-289)

4. Performance: p95/p99 in cards con threshold highlighting
   - Implementazione: cards p95/p99 (righe 160-167, 442-445)
   - Verifica: Unit test frontend 6 (righe 272-273); E2E scenario 5 (righe 289-290)

5. Accesso riservato ad admin
   - Implementazione: JWT + `_is_admin()` (righe 111-113)
   - Verifica: Unit test backend security (riga 255); E2E scenario 7 (riga 291)

6. Anonimizzazione dati aggregati
   - Implementazione: hashing SHA256 `session_id` (righe 33, 113, 333)
   - Verifica: Documentazione/stato implementazione (righe 329-336, 430)

7. UI responsive 2 col desktop / 1 col mobile
   - Implementazione: layout responsive (righe 34, 141-145)
   - Verifica: E2E scenario 8-9 (righe 292-294)

8. Refresh manuale con pulsante
   - Implementazione: `Aggiorna Dati` in header (righe 133-136) + fetch (righe 171-189)
   - Verifica: Unit test frontend 7 (righe 273-274); E2E scenario 6 (righe 290-291)

9. Loading state con skeleton
   - Implementazione: skeleton UI (righe 191)
   - Verifica: Unit test frontend 2 (righe 268-269)

10. Performance API < 500ms (benchmark)
    - Implementazione: aggregation efficiente (righe 85-108)
    - Verifica: Benchmark BT-020 10ms < 500ms (righe 395-396, 461)

## Collegamenti File/Componenti
- Backend: `/apps/api/api/analytics/analytics.py` (riga 473)
- Backend tests: `/apps/api/tests/test_analytics.py` (riga 474)
- Frontend: `/apps/web/src/pages/AnalyticsPage.tsx` (riga 475)
- Frontend tests: `/apps/web/src/pages/__tests__/AnalyticsPage.test.tsx` (riga 476)
- E2E: `/apps/web/tests/story-4.2.spec.ts` (riga 477)
- Documentazione: `/docs/admin-setup-guide.md` (riga 479)

## Stato Verifiche Dichiarato
- Backend unit: 7/7 PASS (righe 457-458, 431-432)
- Frontend unit: 10/10 PASS (righe 458-459, 447)
- E2E: 6/6 PASS (righe 388-389, 459-460)

## Note
- Line Chart temporale differita a Phase 2; KPI cards p95/p99 presenti (righe 31, 442)
- Dati in-memory volatili; persistenza demandata a Phase 2 (riga 236)
