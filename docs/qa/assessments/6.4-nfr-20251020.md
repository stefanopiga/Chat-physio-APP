# NFR Assessment: 6.4

Date: 2025-10-20
Reviewer: Quinn

## Summary

- Security: PASS - JWT auth + admin role checks; rate limiting enforced on admin debug; secrets via .env
- Performance: CONCERNS - No explicit SLOs for indexing and retrieval; retrieval target mentioned (<2s) but not validated in CI; caching strategy for search not defined
- Reliability: PASS - Advisory locks for concurrency; retry (tenacity) on indexing; health endpoint and startup checks
- Maintainability: PASS - Tests across unit/integration/E2E; modified modules target =85% coverage; clear ownership and docs updates

Quality Score: 90

## Evidence & Notes

- Security
  - AuthZ/AuthN: FastAPI deps with JWT; admin checks in pps/api/api/routers/admin.py
  - Rate limiting: RateLimitService present; admin endpoint target 10/hour (Story AC4)
  - Secrets: managed via environment; no hardcoded keys found in changed surfaces
  - Recommendation: ensure embedding_health guarded by admin role + rate limit in code review

- Performance
  - Targets: Story references retrieval <2s; no codified SLOs or CI perf assertions
  - Indexing: batch uses OpenAI embeddings with retries; throughput not specified
  - Recommendation: add perf checks (p95 retrieval <2s) behind --run-integration; capture timings in logs

- Reliability
  - Concurrency: Standardized PostgreSQL advisory locks using DB-side hashtext() (AC2.5)
  - Resilience: Retry logic in indexer; graceful fallback in watcher with logs
  - Health: /admin/debug/embedding-health + watcher startup health check

- Maintainability
  - Tests: unit/integration/E2E files listed and implemented; target =85% for modified modules
  - Docs: monitoring and architecture matrices updated
  - Recommendation: persist coverage gates in CI for modified paths

## Critical Issues

1) Performance SLOs not formalized
   - Risk: regressions unnoticed
   - Fix: add p95 assertions for retrieval + basic load smoke

2) CI lacks perf gates
   - Risk: perf drift
   - Fix: add optional perf job gated by --run-integration

## Quick Wins

- Add timing logs for indexing and retrieval, emit to health endpoint summary
- Add rate limit middleware binding to embedding_health route
- Add perf markers in tests to assert retrieval p95 <2s

NFR assessment: docs/qa/assessments/6.4-nfr-20251020.md

Gate NFR block ready — paste into qa.qaLocation/gates/{epic}.{story}-{slug}.yml under nfr_validation