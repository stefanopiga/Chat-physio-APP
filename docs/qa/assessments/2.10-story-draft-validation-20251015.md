# QA Story Draft Validation – Story 2.10: Batch Ingestion Knowledge Base

Data: 2025-10-15  
Validator: Quinn (Test Architect & Quality Advisor)  
Fonte story: docs/stories/2.10.batch-ingestion-knowledge-base.md  
Stato story: Draft – Re-validated

## Executive Summary

La story è ora completa e testabile: include tabella dei parametri CLI con mapping agli Acceptance Criteria, contratto API formalizzato (payload, header, status codes), preflight blocking con comportamento definito, e Deliverables con percorsi univoci. I rischi principali (rate limiting 429, errori transitori, idempotenza client-side) sono gestiti con strategie esplicite (sleep+jitter, exponential backoff, state file atomico). Pronta per esecuzione e validazione.

## Requirements Traceability (Given-When-Then – sintesi)

- AC1 (Script + Rate Limit + Retry)
  - Given CLI correttamente configurata, When eseguo l’ingestione, Then ogni richiesta rispetta `sleep-seconds` e su 429 adotta backoff+jitter fino a `max-retries`.
- AC2 (Completezza KB)
  - Given sorgente `conoscenza/fisioterapia/`, When eseguo il batch completo, Then il report elenca successi/fallimenti e conteggi coerenti con i chunk generati.
- AC3 (E2E Funzionale)
  - Given KB popolata, When eseguo query di test, Then ottengo risposta coerente con citazioni multiple e `job_id` tracciabile.
- AC4 (Resume & Idempotenza)
  - Given `--state-file` presente, When interrompo e riprendo la run, Then i file già processati non vengono reinviati e non si creano duplicati.
- AC5 (Osservabilità & Operatività)
  - Given preflight eseguito, When avvio lo script, Then log strutturati e comportamento blocking su env mancanti.
- AC6 (Compatibilità & Sicurezza)
  - Given endpoint invariato, When uso JWT admin, Then nessun breaking change e rispetto dei limiti.

## Risk Assessment (probabilità × impatto – estratto)

- RL-001: Picchi 429 non previsti – Medio × Medio – Mitigazione: rate limit proattivo + backoff con jitter e rispetto `Retry-After`.
- IO-002: File corrotti – Medio × Basso – Mitigazione: try/catch estrazione, skip con log ed evidenza nel report.
- ENV-003: Variabili env mancanti – Medio × Medio – Mitigazione: preflight blocking con exit code 1 e messaggio chiaro.

## Testability & Coverage

- Unit: parser CLI, selezione file per pattern, gestione state file, timer/backoff simulati, gestione 429/5xx.
- Integration: run `--limit 1..3` su sottoalbero, verifica `job_id`, checks su `document_chunks`.
- E2E: ingestion → search → chat con citazioni.

## Gate Decision

- Decisione: PASS  
- Rationale: Requisiti specifici, misurabili e allineati al codice; piani di test chiari; mitigazioni documentate.

## Recommendations (non-blocking)

- Aggiungere esempi CLI (dry-run e full-run) con output di esempio nel report.  
- Log di preflight: mascherare segreti con pattern coerente (es. `sk-****1234`).

