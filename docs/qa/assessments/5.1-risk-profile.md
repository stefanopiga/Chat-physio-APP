# Risk Profile — Story 5.1: Project Structure Security Refactoring

## Metadata
- **ID**: 5.1  
- **Tipo**: Technical Debt / Security  
- **Epic**: Epic 5 — DevOps & Maintainability  
- **Priorità**: P0 - Critical (Security Risk)  
- **Complessità**: Medium  
- **Stima sforzo**: 8-12 ore  
- **Stato**: Draft  

Fonti: `docs/stories/5.1-project-structure-security-refactoring.md`.

## Estratti con riferimenti al sorgente

### Contesto e Problemi Critici (linee 28–56)
```28:56:docs/stories/5.1-project-structure-security-refactoring.md
### Current State
**Analisi Esaustiva**: Documentata in `PROJECT_STRUCTURE_ANALYSIS_AND_REFACTORING_PLAN.md`

**Problemi Critici Identificati**:

1. **Security Risk - Credenziali Hardcoded (P0 BLOCKER)**:
   - `generate_admin_jwt.py`: `SECRET_KEY` hardcodato in plaintext
   - `ingest_document_radicolopatia.ps1`: JWT token hardcodato (validità 365 giorni)
   - `temp_env_populated_*.md`: Credenziali parzialmente censurate ma riconoscibili
   - Nessun uso di `python-dotenv` per gestione sicura secrets

2. **Struttura Root Directory Disorganizzata**:
   - 30+ file operativi/temporanei in root senza organizzazione
   - Script PowerShell (`ingest_document_radicolopatia.ps1`, `verify_ingestion.ps1`) in root
   - Report temporanei committati (`STORY_2.4.1_*.md`, `STORY_2.4.2_*.md`)
   - File temporanei committati (`temp_env_populated_*.md`, `payload_ingestion.json`)

3. **Test Directory Frammentata**:
   - `tests_power-shell/` in root (fuori contesto monorepo)
   - Dovrebbe essere integrato con `apps/api/tests/` o `tests/integration/`

4. **Duplicazione Knowledge Base**:
   - `conoscenza/` (source of truth confermato dall'utente)
   - `conoscenza copy/` (backup da mantenere secondo user - linea 89)

5. **Mix Linguaggi Script Senza Motivo Tecnico**:
   - Python (`generate_admin_jwt.py`) + PowerShell (`.ps1`) per operazioni equivalenti
   - Nessuna standardizzazione pattern script operativi
```

### Desired State e Benefici (linee 79–124)
```79:124:docs/stories/5.1-project-structure-security-refactoring.md
### Desired State
**Struttura Target - Best Practices Monorepo**:
...
✅ Security: Nessuna credenziale hardcoded
✅ Manutenibilità: Struttura organizzata e documentata
✅ Conformità: Standard monorepo rispettati
✅ Production-ready: Deployment sicuro abilitato
```

### Rischi (linee 1169–1177)
```1169:1177:docs/stories/5.1-project-structure-security-refactoring.md
## Risks

| ID | Description | Probability | Impact | Mitigation |
|----|-------------|-------------|--------|------------|
| R-5.1-1 | Credenziali già esposte in Git history | Alta | Critico | Git history scan + rotate secrets immediatamente |
| R-5.1-2 | Breaking changes per script esistenti in uso | Media | Medio | Documentazione migrazione completa + backward compatibility temporanea |
| R-5.1-3 | File temporanei committati accidentalmente post-refactoring | Bassa | Basso | `.gitignore` completo + pre-commit hooks |
| R-5.1-4 | Loss di file operativi durante git mv | Bassa | Alto | Backup preventivo prima di git mv + verifica post-spostamento |
```

## Analisi dei Rischi

- **R-5.1-1 — Credenziali già esposte in Git history**  
  - Probabilità: Alta  
  - Impatto: Critico  
  - Mitigazione: Git history scan + rotazione immediata dei secrets.  
  - Fonte: linee 1169–1177.

- **R-5.1-2 — Breaking changes per script esistenti in uso**  
  - Probabilità: Media  
  - Impatto: Medio  
  - Mitigazione: Documentazione migrazione + compatibilità temporanea.  
  - Fonte: linee 1169–1177.

- **R-5.1-3 — Commit accidentale di file temporanei post-refactoring**  
  - Probabilità: Bassa  
  - Impatto: Basso  
  - Mitigazione: `.gitignore` completo + pre-commit hooks.  
  - Fonte: linee 1169–1177.

- **R-5.1-4 — Perdita di file durante `git mv`**  
  - Probabilità: Bassa  
  - Impatto: Alto  
  - Mitigazione: Backup preventivo + verifica post-spostamento.  
  - Fonte: linee 1169–1177.

## Controlli/AC rilevanti come misure di mitigazione

- AC1 Security (linee 130–151): eliminazione credenziali hardcoded, uso `python-dotenv`, `.env.example`, `.gitignore` aggiornato.
- AC2 Struttura (linee 153–179): consolidamento root, `scripts/`, `docs/qa/reports/`, `temp/`, migrazione/eliminazione `tests_power-shell`.
- AC3 Script (linee 181–206): standardizzazione Python, dotenv, docstring, README.
- AC4 Gitignore/Security (linee 208–230): pattern `.env`, `temp/`, backup keys, verifica pre-commit e history scan.
- AC5 Documentazione (linee 232–257): `scripts/README.md`, README di sottodirectory, help CLI, docstring.

## Conclusione
Il profilo dei rischi è definito esclusivamente sulla base del documento sorgente citato riga-per-riga. Eventuali valutazioni ulteriori: non disponibili nel sorgente.
