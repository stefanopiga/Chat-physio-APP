# Requirements Traceability Matrix

## Story: 1.3 - Student Access Code System

### Coverage Summary
- Total Requirements: 7
- Fully Covered: 2 (28.6%)
- Partially Covered: 0 (0%)
- Not Covered: 5 (71.4%)

### Requirement Mappings

#### AC1: Endpoint admin per generare codici
- Coverage: NONE
- Given: Backend API avviata e DB/stub access codes
- When: Admin invoca endpoint generazione codice
- Then: Viene creato un record `AccessCode` persistito
- Notes: I test correnti simulano l'inserimento diretto nello store, non coprono l'endpoint admin
- Suggested tests:
  - BE integration: `POST /admin/access-codes` crea record con attributi attesi
  - Unit: DAL/validator per creazione codici

#### AC2: Endpoint pubblico per validare un codice
- Coverage: FULL
- Tests:
  - BE integration: `apps/api/api/test_main.py::test_exchange_code_invalid_request`
  - BE integration: `apps/api/api/test_main.py::test_exchange_code_invalid_code`
  - BE integration: `apps/api/api/test_main.py::test_exchange_code_expired_code`
- Given: Codice assente/errato/scaduto
- When: POST `/api/v1/auth/exchange-code`
- Then: Risposta 400/401/410 secondo il caso
#### AC3: Un codice valido restituisce un token temporaneo
- Coverage: FULL
- Tests:
  - BE integration: `apps/api/api/test_main.py::test_exchange_code_happy_path_monouse`
  - BE integration: `apps/api/api/test_main.py::test_exchange_code_jwt_claims`
- Given: Un codice valido e attivo
- When: POST `/api/v1/auth/exchange-code`
- Then: 200 con `token`, `token_type`, `expires_in`; JWT con `iss`, `aud`, `sub`, `exp`

#### AC4: La pagina principale ha un campo per il codice
- Coverage: NONE
- Suggested tests:
  - FE unit/integration (RTL): render del campo, placeholder/label, presence in DOM

#### AC5: Inserendo un codice valido, redirect alla chat
- Coverage: NONE
- Suggested tests:
  - FE integration (RTL): mock API success → verifica redirect `/chat`
  - E2E (Playwright): user journey completo
#### AC6: Il campo del codice non può essere inviato se vuoto
- Coverage: NONE
- Suggested tests:
  - FE integration (RTL): blocco submit e messaggio di errore sotto il campo

#### AC7: Messaggio di errore specifico su validazione client-side fallita
- Coverage: NONE
- Suggested tests:
  - FE integration (RTL): error messaging specifico

### Critical Gaps
1. Frontend coverage assente per AC4–AC7 (UI/UX e validazione)
2. Admin endpoint per generare codici non testato (AC1)

### Test Design Recommendations
- Implementare test FE RTL per AC4–AC7
- Aggiungere un test di integrazione BE per l'endpoint admin generazione codice (AC1)
- Considerare E2E scenario felice + negativi

### Risk Assessment
- High Risk: Nessuna copertura FE sulle interazioni utente principali
- Medium Risk: Mancanza test endpoint admin
- Low Risk: BE exchange-code ben coperto con claims JWT
