# 4.2 – NFR Assessment: Analytics Dashboard

## Meta
- Story: 4.2 (docs/stories/4.2.analytics-dashboard.md)
- Data: 2025-10-04
- Stato Story: Implemented ✅ (riga 3)
- Epic: Epic 4 — Post-MVP Enhancements (riga 8)
- Priorità: Medium (riga 9)
- Complessità: Medium (riga 10)

## Ambito (derivato dalla Story)
- Percorso UI: `/admin/analytics` con sezioni Panoramica, Domande, Feedback, Performance (righe 27-31)
- Dati anonimi: no `user_id`, hash di `session_id` (righe 33, 113)
- Refresh manuale (nessun auto-refresh) (riga 35)
- Loading state con skeleton UI (riga 36, 191)
- Performance cards P95/P99; Line Chart rinviata a Phase 2 (riga 31)

## Requisiti Non Funzionali (estratti/derivati dalla Story)

### Sicurezza
- Autenticazione admin obbligatoria per endpoint analytics: JWT + check `_is_admin()` (righe 111-113)
- Anonimizzazione: hash SHA256 di `session_id`; nessun `user_id` esposto (righe 33, 113, 333)
- Rate limiting: 30/hour sull’endpoint analytics (riga 112)

### Prestazioni
- Target API: aggregation completa < 500ms su dataset di benchmark (riga 256)
- Evidenza benchmark: 10ms < 500ms target (BT-020) (righe 395-396, 461)
- KPI performance visualizzati: p95/p99 in ms (righe 160-167, 442-445)

### Affidabilità e Dati
- Sorgenti dati in-memory: `chat_messages_store`, `feedback_store`, `ag_latency_samples_ms` (righe 79-82)
- Rischio accettato: dati volatili, persistenza demandata a Phase 2 (riga 236)
- Mitigazioni: rate limiting 30/hour; cache 60s opzionale (riga 239)

### Scalabilità
- Aggregazioni con conteggi normalizzati e top 10 query (righe 85-98)
- Limitazione UI della tabella a max ~10 righe (riga 309)

### Usabilità e Accessibilità
- Layout responsive: 2 colonne desktop, 1 colonna mobile (righe 34, 292-293)
- Skeleton UI per caricamento (righe 36, 191)
- Accessibilità: `role="img"`/`aria-label` per chart; `th` con `scope` per tabelle; label per pulsante refresh (righe 314-317)

### Manutenibilità e Estendibilità
- Obiettivo estendibilità: aggiunta nuova metrica < 30 LOC (riga 413)
- Pattern di componenti e librerie standardizzate (Card, Recharts) (righe 203-218, 343-357)

## Rischi NFR (dalla Story)
- R-4.2-1: Dati in-memory limitati – Probabilità Alta, Impatto Alto; debito tecnico accettato (riga 236)
- R-4.2-2: Privacy leak `session_id` – Probabilità Bassa, Impatto Alto; hashing SHA256 obbligatorio (riga 237)
- R-4.2-3: Lentezza aggregazioni – Probabilità Media, Impatto Medio; limit 30/hour e cache 60s opzionale (riga 239)
- R-4.2-4: Aumento bundle per chart – Probabilità Bassa, Impatto Basso; Recharts ~95KB gzipped, lazy load della route (riga 239)
- R-4.2-5: Regressioni layout mobile – Probabilità Bassa, Impatto Medio; pattern validato + test viewport (riga 240)

## Evidenze di Verifica (dalla Story)
- Unit test backend: 6 casi definiti (righe 250-257); esecuzione riportata 7/7 PASS (righe 457-458, 431-432)
- Unit test frontend: 8 casi definiti (righe 266-274); esecuzione 10/10 PASS (righe 458-459, 447)
- E2E: 10 scenari definiti (righe 284-295); esecuzione 6/6 PASS (righe 388-389, 459-460)
- Profiling prestazioni: aggregation 10ms < 500ms (righe 395-396, 461)
- Documentazione: sezione Analytics in `admin-setup-guide.md` (righe 398-403, 463-467)

## Gap e Limitazioni Note
- Persistenza analytics non implementata in questa fase; dati volatili (riga 236)
- Line Chart temporale p95/p99 rinviata a Phase 2; MVP con cards (riga 31, 442)

## Conclusione
In base ai dati della Story, i principali NFR sono soddisfatti: sicurezza (auth admin, anonimizzazione, rate limiting), performance (<500ms con evidenza 10ms), usabilità/accessibilità (responsive, skeleton, attributi ARIA), con un debito tecnico accettato sulla persistenza dati e differimento della Line Chart temporale.
