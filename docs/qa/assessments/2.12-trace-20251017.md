# Requirements Traceability Matrix

## Story: 2.12 - Integrazione e Centralizzazione gpt-5-nano

### Coverage Summary

- Total Requirements: 5
- Fully Covered: 2 (40%)
- Partially Covered: 2 (40%)
- Not Covered: 1 (20%)

### Requirement Mappings

#### AC1: Configurazione Centralizzata LLM
- Unit Test: apps/api/tests/test_settings_llm.py::test_model_defaults_and_overrides
  - Given: Settings con env di default/override
  - When: Carico Settings e accedo ai campi openai_*
  - Then: I default sono corretti e gli override via env vengono applicati
  - Coverage: full

#### AC2: Refactoring Chat Service
- Integration Test: apps/api/tests/routers/test_chat.py::test_chat_uses_settings_model (da aggiungere se assente)
  - Given: App con Depends(get_settings) che ritorna modello custom
  - When: Invoco endpoint chat
  - Then: ChatOpenAI viene istanziato con il modello da Settings
  - Coverage: partial

#### AC3: Refactoring Classifier
- Integration Test: apps/api/tests/test_enhanced_classification.py::test_classifier_uses_settings (da confermare/aggiungere)
  - Given: Settings con OPENAI_MODEL e OPENAI_TEMPERATURE_CLASSIFICATION
  - When: Eseguo classificazione
  - Then: LLM usa modello e temperatura da Settings
  - Coverage: partial

#### AC4: Documentazione e Environment
- Unit Test: apps/api/tests/test_settings_llm.py::test_env_template_sync (da aggiungere)
  - Given: Template ENV con sez. OpenAI
  - When: Verifico variabili richieste
  - Then: Template include OPENAI_MODEL e temperature richieste
  - Coverage: none

#### AC5: Testing e Validazione
- Integration Test: apps/api/tests/test_llm_integration.py::test_overrides_work (da aggiungere)
  - Given: Override di get_settings con valori custom
  - When: Invoco chat e classifier
  - Then: Entrambi usano configurazione centralizzata
  - Coverage: none

### Critical Gaps

1. Mancano test di integrazione per chat/classifier che validino l'uso di Settings
   - Risk: Medio-Alto
   - Action: Aggiungere test indicati in AC2/AC3/AC5

2. Mancano verifiche documentazione/env template (AC4)
   - Risk: Medio
   - Action: Aggiungere test unitario di coerenza ENV template

### Test Design Recommendations

- Implementare test indicati per colmare i gap
- Usare monkeypatch per override di get_settings nelle integrazioni
- Aggiungere fixture per Settings mockate

### Risk Assessment

- High Risk: Requisiti con coverage none (AC4, AC5)
- Medium Risk: Coverage partial su integrazioni (AC2, AC3)
- Low Risk: AC1 completamente coperto dai test Settings

