### Profilo Rischi — Story 5.4.1: Suite-wide Test Fixes & Pattern Propagation

- **ID**: 5.4.1 (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- **Tipo**: Technical Debt / Testing / Bugfix (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- **Epic**: Epic 5 — DevOps & Maintainability (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- **Priorità**: P1 - High (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- **Complessità**: High (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- **Stato**: DRAFT (2025-10-09) (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Contesto sintetico
- Baseline suite: 143 PASSED, 33 FAILED, 15 ERRORS, 14 SKIPPED; Pass Rate 73.7%; Duration 471.64s; Coverage 93% (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Target: Pass Rate >90%, Failed <10, Errors 0, Duration <500s, Coverage ≥93% (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Obiettivo
- Applicare pattern fix di Story 5.4 alla suite completa per sbloccare CI/CD e raggiungere pass rate >90% (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Registro rischi

1) **R1: FK Cascade Deletion Complexity** (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Descrizione: complessità nella cancellazione in cascata causa violazioni FK in `student_tokens` (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Probabilità: not available in source
- Impatto: not available in source
- Mitigazione: cleanup order esplicito, try-except defense (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Rilevazione/Monitoraggio: test FK constraints in CI (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

2) **R2: Schema Breaking Changes Propagation** (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Descrizione: mancata propagazione cambi schema API (`total_chunks`, `similarity_score`) a tutti i consumer/endpoint (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Probabilità: not available in source
- Impatto: not available in source
- Mitigazione: audit script per trovare tutti gli endpoint (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Rilevazione/Monitoraggio: integration tests con real API calls; KeyError assenti (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

3) **R3: Test Isolation Side Effects** (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Descrizione: effetti collaterali dovuti a scope fixture e ordine cleanup (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Probabilità: not available in source
- Impatto: not available in source
- Mitigazione: fixture scope function, cleanup garantito (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Rilevazione/Monitoraggio: esecuzione con ordine casuale (`pytest --random-order`) (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

4) **R4: Performance Regression** (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Descrizione: regressioni di performance e timeout residui (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Probabilità: not available in source
- Impatto: not available in source
- Mitigazione: timeout monitoring, checkpoint logging (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Rilevazione/Monitoraggio: performance test suite separata; target Duration <500s (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Vincoli e metriche di successo
- Pass Rate: >90% (180+/194) (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Failed: <10 (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Errors: 0 (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Coverage: ≥93% (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Duration: <500s (baseline 471.64s) (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Dipendenze e blocchi
- Prerequisiti: Story 5.4 completata; baseline suite: 143 PASSED / 48 FAILED+ERRORS (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Blocchi: Merge Story 5.2/5.3/5.4 su master; CI/CD green build (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Ambito e fuori scope
- In scope: propagazione pattern Story 5.4; eliminazione FK violations; compliance schema API; migrazione import; fix auth nei test; skip condizionale rate limit; validazione suite (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Out of scope: ottimizzazione performance `test_performance_semantic_search.py` p95 5253ms; refactoring completo E2E; aumento coverage >93%; suite separata rate limiting (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Piano di monitoraggio
- CI: green build richiesto; assenza di FK violations; assenza di KeyError schema (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Test: full suite con `--cov=api`; nessun 401 nei test di integrazione sync job; nessun timeout (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)

### Decision log
- not available in source

### Approvazioni
- Story Owner: Backend Team; Reviewers: Tech Lead, QA Engineer (fonte: docs/stories/5.4.1-suite-wide-test-fixes.md)
- Approvazioni esplicite: not available in source
