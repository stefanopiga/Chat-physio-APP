# Test Design: Story 1.3

Date: 2025-09-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 12
- Unit tests: 3 (25%)
- Integration tests: 6 (50%)
- E2E tests: 3 (25%)
- Priority distribution: P0: 6, P1: 4, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Endpoint admin per generare codici

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-UNIT-001 | Unit        | P1       | Valida generazione stringa codice (formato, lunghezza)        | Logica isolabile                               |
| 1.3-INT-001  | Integration | P0       | POST admin/generate crea `AccessCode` con campi previsti       | Interazione API↔DB (PostgREST/BE)              |
| 1.3-INT-002  | Integration | P0       | Endpoint protetto: 401/403 senza token admin                   | Security path                                  |

### AC2: Endpoint pubblico per validare un codice

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-UNIT-002 | Unit        | P1       | Validator formato input codice                                 | Logica isolabile                               |
| 1.3-INT-003  | Integration | P0       | Codice attivo/non scaduto → 200                                | Contratto endpoint                             |
| 1.3-INT-004  | Integration | P0       | Codice inesistente/inattivo/scaduto → 4xx                      | Error handling critico                         |

### AC3: Un codice valido restituisce un token temporaneo

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-INT-005  | Integration | P0       | Validazione ok → risposta contiene token temporaneo            | Contratto di risposta                          |
| 1.3-INT-006  | Integration | P0       | Token temporaneo rifiutato se parametri mancanti/invalidi      | Robustezza                                     |

Note: issuer/formato/claims/audience/durata del token: not available in source (blocca asserzioni profonde).

### AC4: Campo codice in pagina principale

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-UNIT-003 | Unit        | P2       | Rendering input e stato controllato                            | Logica UI isolata                              |
| 1.3-E2E-001  | E2E         | P1       | Presenza campo codice nella home                               | Journey base                                   |

### AC5: Redirect alla chat su codice valido

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-E2E-002  | E2E         | P0       | Inserimento codice valido → redirect a /chat                   | Percorso utente critico                        |

### AC6–AC7: Validazione client-side e error message

| ID           | Level       | Priority | Test                                                           | Justification                                  |
| ------------ | ----------- | -------- | -------------------------------------------------------------- | ---------------------------------------------- |
| 1.3-INT-007  | Integration | P1       | Submit con input vuoto → blocco + messaggio sotto il campo     | Comportamento form + validazione FE            |
| 1.3-E2E-003  | E2E         | P1       | Inserimento non valido → messaggio specifico in UI             | Esperienza utente                              |

## Risk Coverage

- P0 focalizzati su security/contract (AC1 protezione admin, AC2/AC3 comportamento endpoint, AC5 journey critico).
- Rischi correlati al token temporaneo rimangono parziali per mancanza specifica (not available in source).

## Recommended Execution Order

1. P0 Unit/Integration (1.3-INT-001, 1.3-INT-002, 1.3-INT-003, 1.3-INT-004, 1.3-INT-005)
2. P0 E2E (1.3-E2E-002)
3. P1 scenari UI/FE (1.3-UNIT-003, 1.3-INT-007, 1.3-E2E-003)
4. P2 rimanenti

## Gate YAML Block

test_design:
  scenarios_total: 12
  by_level:
    unit: 3
    integration: 6
    e2e: 3
  by_priority:
    p0: 6
    p1: 4
    p2: 2
  coverage_gaps:
    - 'AC3: specifica token (issuer/formato/claims/audience/durata) non definita — not available in source'
