# Test Design: Story 2.1

Date: 2025-09-16
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 3 (30%)
- Integration tests: 6 (60%)
- E2E tests: 1 (10%)
- Priority distribution: P0: 4, P1: 4, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Il servizio accede a una directory di file

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-UNIT-001  | Unit        | P1       | Validazione configurazione path e permessi di lettura            | Logica isolabile                                |
| 2.1-INT-001   | Integration | P0       | Accesso directory reale/mocked con file presenti/assenti         | IO + interazione FS                             |

### AC2: Scansiona file nuovi/modificati

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-UNIT-002  | Unit        | P1       | Calcolo `file_hash` coerente e deterministico                    | Funzione pura                                   |
| 2.1-INT-002   | Integration | P0       | Inventario iniziale + rilevazione modifiche                      | Stato + IO                                      |

### AC3: Estrazione testo corretta da `.pdf`/`.docx`

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-INT-003   | Integration | P0       | Loader `.pdf` estrae testo atteso (fixture)                      | Contratto estrattori                            |
| 2.1-INT-004   | Integration | P0       | Loader `.docx` estrae testo atteso (fixture)                     | Contratto estrattori                            |
| 2.1-INT-005   | Integration | P1       | Gestione caratteri speciali/encoding                             | Robustezza                                      |

### AC4: Salvataggio temporaneo del contenuto

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-INT-006   | Integration | P1       | Persistenza metadati `Document` con `file_name/path/hash/status` | Modello dati + DAL                              |

### AC5: Gestione errori di parsing

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-UNIT-003  | Unit        | P2       | Classificazione errori recuperabili vs non recuperabili          | Logica mappatura errori                         |
| 2.1-INT-007   | Integration | P1       | Marcatura `Document.status` su failure parsing                   | Stato coerente                                  |

### E2E di coerenza pipeline (sanity)

| ID            | Level       | Priority | Test                                                             | Justification                                  |
| ------------- | ----------- | -------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| 2.1-E2E-001   | E2E         | P2       | Job/watcher elabora file di esempio end-to-end                   | Filo conduttore minimo                          |

## Risk Coverage

- Copertura `SEC-001` indiretta tramite test di configurazione (confinamento server-side verificabile in setup/ops, non in codice: not available in source per asserzioni runtime).
- `TECH-001` coperta da INT-003/004/005; `OPS-001` da E2E-001 con verifica log; `DATA-001` da INT-007.

## Recommended Execution Order

1. P0 Integration (2.1-INT-001/002/003/004)
2. P0 Unit/Integration rimanenti
3. P1 suite (INT-005/006/007)
4. P2 (UNIT-003, E2E-001)

## Gate YAML Block

test_design:
  scenarios_total: 10
  by_level:
    unit: 3
    integration: 6
    e2e: 1
  by_priority:
    p0: 4
    p1: 4
    p2: 2
  coverage_gaps: []

## Sources

- `docs/stories/2.1.document-loader-and-text-extractor.md` (AC1â€“AC5)
- `docs/architecture/sezione-4-modelli-di-dati.md` (Document)
- `docs/architecture/sezione-6-componenti.md` (Ingestion Service)
