# Test Design — Story 4.1: Admin Debug View

## Riferimenti

- Fonte primaria: `docs/stories/4.1.admin-debug-view.md`
- Profilo rischi (aggiornato): `docs/qa/assessments/4.1-risk-20251001.md`

## Gating / Prerequisiti (Bloccanti)

### Dipendenze Tecniche (Status: Done)
- Story 1.2 (Admin Login System): JWT verification infrastructure disponibile. [Fonte: `docs/stories/4.1.admin-debug-view.md` L32]
- Story 3.1 (Semantic Search): Retrieval logic riutilizzabile. [Fonte: `docs/stories/4.1.admin-debug-view.md` L33]
- Story 3.2 (Augmented Generation): LLM generation logic riutilizzabile. [Fonte: `docs/stories/4.1.admin-debug-view.md` L34]
- Tech Story (Tailwind + Shadcn/UI): UI component library disponibile. [Fonte: `docs/stories/4.1.admin-debug-view.md` L35]

### Prerequisiti Implementativi (Pre-Testing)
- Endpoint `POST /api/v1/admin/debug/query` implementato con Pydantic models `DebugQueryRequest` e `DebugQueryResponse`. [Fonte: `docs/stories/4.1.admin-debug-view.md` L91–L93]
- Admin auth check (role=admin) implementato e testato. [Fonte: `docs/stories/4.1.admin-debug-view.md` L41, L94]
- Rate limiting configurato per endpoint debug (10 queries/hour). [Fonte: `docs/stories/4.1.admin-debug-view.md` L166]
- Frontend route `/admin/debug` protetta da `AdminGuard`. [Fonte: `docs/stories/4.1.admin-debug-view.md` L113]
- Componenti Shadcn/UI necessari installati: Textarea, Card, Badge, Accordion (se usato). [Fonte: `docs/stories/4.1.admin-debug-view.md` L107]
- Sanitization markdown configurata. [Fonte: `docs/stories/4.1.admin-debug-view.md` L75, L156]

## Obiettivi di Test

- Coprire tutti gli Acceptance Criteria (8) e i rischi prioritari (R-4.1-1…R-4.1-5) come da fonti.

## Casi di Test (estratti)

### AC1 — Sezione "Debug RAG" nel Pannello Admin

**TC-001** — Route `/admin/debug` accessibile da admin autenticato
- Given: Admin autenticato (JWT role=admin)
- When: Navigazione a `/admin/debug`
- Then: Pagina "Debug RAG" visibile
- Fonte: `docs/stories/4.1.admin-debug-view.md` L15

**TC-002** — Blocco accesso non autenticato
- Given: Nessun JWT
- When: Accesso diretto `/admin/debug`
- Then: 401/redirect
- Fonte: `docs/stories/4.1.admin-debug-view.md` L23, L113

### AC2 — Input Domanda di Test

**TC-010** — Textarea con label e placeholder
- Fonte: `docs/stories/4.1.admin-debug-view.md` L139–L141

### AC3 — Visualizzazione Risposta Finale + Chunk + Metadati

**TC-020** — Sezione "Risposta Finale" presente
- Fonte: `docs/stories/4.1.admin-debug-view.md` L17–L18, L143

**TC-021** — Lista chunk con count
- Fonte: `docs/stories/4.1.admin-debug-view.md` L19, L144

**TC-022** — Content preview primi 200 caratteri
- Fonte: `docs/stories/4.1.admin-debug-view.md` L82

**TC-023** — Similarity score badge
- Fonte: `docs/stories/4.1.admin-debug-view.md` L19, L77, L145

**TC-024** — Metadati completi (document_name, page_number, chunking_strategy)
- Fonte: `docs/stories/4.1.admin-debug-view.md` L20, L52–L57

**TC-025** — Timing metrics visibili
- Fonte: `docs/stories/4.1.admin-debug-view.md` L83, L147

### AC4 — Ordinamento per rilevanza (score decrescente)

**TC-030** — Ordinamento score desc
- Fonte: `docs/stories/4.1.admin-debug-view.md` L21

### AC5 — Distinzione visiva risposta/chunk

**TC-040** — Sezioni distinte
- Fonte: `docs/stories/4.1.admin-debug-view.md` L22, L81

### AC6 — Accesso solo admin autenticati

**TC-050** — Endpoint richiede JWT; 401 se assente
- Fonte: `docs/stories/4.1.admin-debug-view.md` L41, L93

**TC-051** — 403 se role!=admin
- Fonte: `docs/stories/4.1.admin-debug-view.md` L41, L94

**TC-052** — 200 con JWT admin
- Fonte: `docs/stories/4.1.admin-debug-view.md` L94

### AC7 — Theming Light/Dark

**TC-060** — Tema Light/Dark corretti; nessun colore hard-coded
- Fonte: `docs/stories/4.1.admin-debug-view.md` L24–L25, L68, L125

### AC8 — Accessibilità

**TC-070** — Label su controls, focus visibile, keyboard nav
- Fonte: `docs/stories/4.1.admin-debug-view.md` L25, L121–L124

## Backend Test Design

- Request/Response schema come in story. [Fonte: `docs/stories/4.1.admin-debug-view.md` L42–L63]
- Unit/Integration: auth, rate limit, timing, error handling. [Fonte: `docs/stories/4.1.admin-debug-view.md` L100–L103]

## E2E (scenari principali)

- Happy path admin → query → risposta + chunk + timing. [Fonte: `docs/stories/4.1.admin-debug-view.md` L128–L133]
- Auth guard studente/anonimo. [Fonte: `docs/stories/4.1.admin-debug-view.md` L23, L113]
- Theming e accessibilità. [Fonte: `docs/stories/4.1.admin-debug-view.md` L24–L25, L121–L126]

## Metriche Minime

- Coverage backend endpoint debug ≥95% su auth e flow principali. [Fonte: `docs/stories/4.1.admin-debug-view.md` L100–L103]
- E2E principali passanti (happy path, auth, empty/error). [Fonte: `docs/stories/4.1.admin-debug-view.md` L128–L134]

## Note

- Mantiene esclusivamente elementi espliciti nella story; valori non presenti marcati come non disponibili.
