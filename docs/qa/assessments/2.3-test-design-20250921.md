# Test Design: Story 2.3

Date: 2025-09-21 [Fonte: user_info Current Date]
Designer: Quinn (Test Architect) [Fonte: `.cursor/rules/bmad/qa.mdc` L38–L41]

## Test Strategy Overview

- Total test scenarios: 8 [Fonte: questo documento]
- Unit tests: 4 [Fonte: questo documento]
- Integration tests: 4 [Fonte: questo documento]
- E2E tests: 0 [Fonte: questo documento]
- Priority distribution: P0: 0, P1: 4, P2: 4 [Fonte: questo documento]

## Test Scenarios by Acceptance Criteria

### AC1: Almeno due strategie di chunking implementate [Fonte: `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md`]

| ID            | Level | Priority | Test                                                                 | Justification                                                                                                 |
| ------------- | ----- | -------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| 2.3-UNIT-001  | Unit  | P2       | Esecuzione chunking con `RecursiveCharacterTextSplitter`             | Logica di chunking isolabile; livello unit appropriato [Fonte: `docs/architecture/sezione-11-strategia-di-testing.md`]
| 2.3-UNIT-002  | Unit  | P2       | Esecuzione chunking con splitter tabellare/strutturale                | Strategia alternativa prevista in story (placeholder) [Fonte: `docs/stories/2.3.polymorphic-chunking-router.md` L45]

### AC2: Definita una strategia di fallback [Fonte: `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md`]

| ID            | Level       | Priority | Test                                                                                 | Justification                                                                                                                           |
| ------------- | ----------- | -------- | ------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| 2.3-INT-001   | Integration | P1       | Router applica fallback quando `confidenza < 0.85`                                   | Regola di fallback definita [Fonte: `docs/architecture/sezione-6-componenti.md` §6.3.5 L102–L105; `docs/architecture/sezione-11-strategia-di-testing.md`]
| 2.3-UNIT-003  | Unit        | P2       | Router seleziona fallback per classificazione non supportata                          | Logica di selezione isolabile [Fonte: `docs/architecture/sezione-11-strategia-di-testing.md`]

### AC3: Il sistema applica la strategia corretta o il fallback [Fonte: `docs/architecture/sezione-6-componenti.md` §6.3.5 L100–L105]

| ID            | Level       | Priority | Test                                                                                 | Justification                                                                                                                           |
| ------------- | ----------- | -------- | ------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| 2.3-INT-002   | Integration | P1       | Se `classificazione=TESTO_ACCADEMICO_DENSO` → router usa `RecursiveCharacterTextSplitter` | Selezione strategia basata su classificazione [Fonte: `docs/architecture/sezione-6-componenti.md` §6.3.5 L102–L103]
| 2.3-INT-003   | Integration | P1       | Se `classificazione=PAPER_SCIENTIFICO_MISTO` → router usa splitter configurato        | Strategia distinta per contenuto misto [Fonte: `docs/architecture/sezione-6-componenti.md` §6.3.5 L102–L103]

### AC4: Il testo viene suddiviso in chunk con riferimento alla sorgente [Fonte: `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md`]

| ID            | Level       | Priority | Test                                                                 | Justification                                                                                                 |
| ------------- | ----------- | -------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| 2.3-INT-004   | Integration | P1       | Dopo il chunking, i chunk includono riferimento alla sorgente in metadata | Requisito di tracciabilità post-chunking [Fonte: `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md`]

### AC5: Design modulare [Fonte: `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md`]

| ID            | Level | Priority | Test                                                                 | Justification                                                                                                 |
| ------------- | ----- | -------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| 2.3-UNIT-004  | Unit  | P2       | Le strategie implementano un'interfaccia `ChunkingStrategy`; il router gestisce la registrazione/mapping | Verifica struttura modulare [Fonte: `docs/stories/2.3.polymorphic-chunking-router.md` L54–L58]

## Risk Coverage

- 2.3-UNIT-002, 2.3-INT-002, 2.3-INT-003 → mitiga TECH-CH-1 [Fonte: `docs/qa/assessments/2.3-risk-20250919.md` L32]
- 2.3-INT-004 → mitiga OPS-CH-1 [Fonte: `docs/qa/assessments/2.3-risk-20250919.md` L33]

## Recommended Execution Order

1. P0 Unit tests: non applicabile [Fonte: questo documento]
2. P0 Integration tests: non applicabile [Fonte: questo documento]
3. P1 tests in order: 2.3-INT-001, 2.3-INT-002, 2.3-INT-003, 2.3-INT-004 [Fonte: questo documento]
4. P2 tests: 2.3-UNIT-001, 2.3-UNIT-002, 2.3-UNIT-003, 2.3-UNIT-004 [Fonte: questo documento]

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 8
  by_level:
    unit: 4
    integration: 4
    e2e: 0
  by_priority:
    p0: 0
    p1: 4
    p2: 4
  coverage_gaps: []
```

## Trace References

Test design matrix: qa.qaLocation/assessments/2.3-test-design-20250921.md

## Sources

- `docs/stories/2.3.polymorphic-chunking-router.md` (AC, struttura e tasks)
- `docs/prd/sezione-8-epic-2-dettagli-core-knowledge-pipeline.md` (AC Epic 2.3)
- `docs/architecture/sezione-6-componenti.md` §6.3.5 (uso nel processo di ingestion)
- `docs/architecture/sezione-11-strategia-di-testing.md` (livelli di test)
- `.cursor/rules/bmad/qa.mdc` (identità QA)
- `docs/qa/assessments/2.3-risk-20250919.md` (rischi TECH-CH-1, OPS-CH-1)


