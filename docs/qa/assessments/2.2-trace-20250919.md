# Story 2.2 – Requirements Traceability

Fonte: `docs/stories/2.2.structural-analysis-meta-agent.md`
Data: 2025-09-19

## Tracciabilità Requisiti → Test

- AC1: Prompt con `PydanticOutputParser` e `format_instructions` per vincolare l'output.
  - Test: TD-AC1 (verifica presenza `format_instructions` e `partial_variables`).
  - Riferimenti: story L13; architettura 6.3.1–6.3.2.
  - GWT:
    - Given: PromptTemplate con `partial_variables` e `format_instructions` del parser.
    - When: viene costruita la catena `prompt | llm | parser`.
    - Then: il prompt include le `format_instructions` del `PydanticOutputParser`.

- AC2: Output validato Pydantic con `classificazione`, `motivazione`, `confidenza`.
  - Test: TD-AC2 (validazione schema Pydantic e range confidenza).
  - Riferimenti: story L14; architettura 6.3.1, 6.3.3–6.3.4.
  - GWT:
    - Given: modello Pydantic con campi `classificazione`, `motivazione`, `confidenza` e validazione range.
    - When: la catena produce l'output e viene effettuato il parsing Pydantic.
    - Then: l'oggetto risultante contiene i tre campi richiesti e `confidenza` ∈ [0.0, 1.0].

- AC3: Logging strutturato JSON dell'output di classificazione.
  - Test: TD-AC3 (verifica `model_dump_json()` e logging JSON).
  - Riferimenti: story L15; architettura 6.3.7.
  - GWT:
    - Given: output Pydantic dell'endpoint di classificazione.
    - When: viene generato il log dell'esito di classificazione.
    - Then: il log contiene l'output serializzato in JSON tramite `model_dump_json()`.

- AC4: Categorie minime definite: `TESTO_ACCADEMICO_DENSO`, `PAPER_SCIENTIFICO_MISTO`, `DOCUMENTO_TABELLARE`.
  - Test: TD-AC4 (verifica presenza categorie in doc/config e utilizzo nel componente).
  - Riferimenti: story L16; architettura 6.3.8.
  - GWT:
    - Given: elenco categorie minime definito nel sistema.
    - When: viene richiesto di classificare un documento.
    - Then: la `classificazione` appartiene all'insieme specificato di categorie minime.

- AC5: Endpoint `/classify` esposto e test di integrazione con mock della catena LCEL.
  - Test: TD-AC5 (integrazione con mock chain, risposta valida, 200).
  - Riferimenti: story L17; architettura 6.3.6, 6.3.9.
  - GWT:
    - Given: endpoint `/classify` disponibile e catena LCEL mockata.
    - When: viene inviato un testo valido al POST `/classify`.
    - Then: la risposta è 200 e rispetta lo schema (`classificazione`, `motivazione`, `confidenza`).

## Note
- Dati/fixture e ambiente: non disponibili nella fonte.
- Tracciabilità copre esclusivamente quanto presente nella story e nella sezione architetturale referenziata.
