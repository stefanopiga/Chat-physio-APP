# Risk Profile: Story 2.1

Date: 2025-09-16
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 4
- Critical Risks: 0
- High Risks: 1
- Risk Score: 81/100

## Critical Risks Requiring Immediate Attention

Nessuna

## Risk Distribution

### By Category

- Security: 1 (0 critical)
- Technical: 1 (0 critical)
- Operational: 1 (0 critical)
- Data: 1 (0 critical)

### By Component

- Backend: 4

## Detailed Risk Register

| Risk ID  | Description                                                                                 | Probability | Impact     | Score | Priority |
| -------- | ------------------------------------------------------------------------------------------- | ----------- | ---------- | ----- | -------- |
| SEC-001  | Uso improprio della `service_role_key` per ingestione che bypassa RLS                      | Medium (2)  | High (3)   | 6     | High     |
| TECH-001 | Errori di parsing `.pdf`/`.docx` nei loader                                                | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-001  | Watcher/Job ingestione privo di logging/monitoring con failure silenziosi                  | Low (1)     | Medium (2) | 2     | Low      |
| DATA-001 | Persistenza temporanea del contenuto con possibili stati inconsistenti in caso di crash    | Low (1)     | Medium (2) | 2     | Low      |

### Mitigations

- SEC-001
  - Strategy: preventive
  - Actions:
    - Limitare l'uso della `service_role_key` al solo backend per operazioni amministrative di ingestione
    - Gestire segreti via variabili d'ambiente
  - Testing requirements:
    - Verifica accessi solo lato server per job/admin
  - Residual risk: Low
  - Owner: dev
  - Timeline: prima del deploy

- TECH-001
  - Strategy: preventive
  - Actions:
    - Gestione errori di parsing e logging strutturato
    - Marcatura `status` nel modello `Document` per fallimenti
  - Testing requirements:
    - Mock estrattori e IO; testare casi negativi
  - Residual risk: Low
  - Owner: dev
  - Timeline: prima del merge

- OPS-001
  - Strategy: detective
  - Actions:
    - Aggiungere logging e health check per job/watcher
  - Testing requirements:
    - Test di failure injection e verifica log
  - Residual risk: Low
  - Owner: dev
  - Timeline: prima del deploy

- DATA-001
  - Strategy: preventive
  - Actions:
    - Distinguere errori recuperabili/non; garantire atomicit√† aggiornamenti `Document`
  - Testing requirements:
    - Test di resilienza su crash/interruzioni
  - Residual risk: Low
  - Owner: dev
  - Timeline: prima del merge

## Risk-Based Testing Strategy

### Priority 1: High
- Verifica confinamento `service_role_key` lato server

### Priority 2: Medium
- Negative parsing cases `.pdf`/`.docx`; marcatura `Document.status`

### Priority 3: Low
- Health/log per watcher; consistenza su crash

## Monitoring Requirements

- Log strutturati sull'ingestione; verifiche di health del processo

## Sources

- `docs/architecture/sezione-10-sicurezza-e-performance.md` (uso `service_role_key` per operazioni amministrative, RLS)
- `docs/stories/2.1.document-loader-and-text-extractor.md` (AC5 errori parsing; AC4 salvataggio temporaneo)
- `docs/architecture/sezione-4-modelli-di-dati.md` (modello `Document` con `status`/metadati)
- `docs/architecture/sezione-6-componenti.md` (Ingestion Service con DocumentLoaders/TextSplitters)
